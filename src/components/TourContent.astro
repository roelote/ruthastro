---
interface Props {
  post: any;
  featuredImageUrl: string;
  toursWithImages: any[];
  testimonials: any[];
}

const { post, featuredImageUrl, toursWithImages, testimonials } = Astro.props;
---

<!-- Hero del Tour con Background -->
<section class="relative h-[500px] md:h-[550px] overflow-hidden">
  <!-- Imagen de fondo -->
  <div class="absolute inset-0 hero-background">
    <img 
      src={featuredImageUrl}
      alt={post.title.rendered}
      class="w-full h-full object-cover"
    />
    <div class="absolute inset-0 bg-gradient-to-r from-black/80 via-black/60 to-black/40"></div>
  </div>

  <!-- Contenido -->
  <div class="relative z-10 container h-full flex items-center">
    <div class="max-w-3xl">
      <div class="inline-block mb-3">
        <span class="bg-yellow-400 text-gray-900 font-semibold px-3 py-1 rounded-full text-xs uppercase tracking-wider">
          Tour Amazónico
        </span>
      </div>
      
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4 text-white leading-tight" set:html={post.title.rendered} />
      
      <div class="flex flex-wrap gap-4 mb-6 text-gray-200 text-sm md:text-base">
        {post.acf?.duracion && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{post.acf.duracion}</span>
          </div>
        )}
        {post.acf?.grupo_minimo && post.acf?.grupo_maximo && (
          <div class="flex items-center gap-2">
            <svg class="w-4 h-4 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
            <span>{post.acf.grupo_minimo} - {post.acf.grupo_maximo} personas</span>
          </div>
        )}
      </div>

      <div class="flex flex-col sm:flex-row gap-3">
        <a 
          href={`https://wa.me/51965001929?text=Hola, quisiera información sobre ${encodeURIComponent(post.title.rendered)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="inline-flex items-center justify-center gap-2 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-xl text-sm md:text-base"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
          Contáctenos
        </a>
        {post.acf?.precio && (
          <div class="inline-flex items-center justify-center gap-2 bg-[#15803d] text-white font-bold px-6 py-3 rounded-lg shadow-xl">
            <span class="text-xs">Desde</span>
            <span class="text-xl">{post.acf.precio}</span>
          </div>
        )}
      </div>
    </div>
  </div>

  <!-- Elementos decorativos -->
  <div class="absolute top-10 right-10 w-32 h-32 bg-yellow-400/10 rounded-full blur-3xl"></div>
  <div class="absolute bottom-10 left-10 w-40 h-40 bg-[#15803d]/10 rounded-full blur-3xl"></div>
</section>

<!-- Contenido Principal -->
<section class="py-8 bg-white">
  <div class="container">
    <div class="grid lg:grid-cols-3 gap-12">
      <!-- Contenido del Tour -->
      <div class="lg:col-span-2">
        <div class="prose prose-lg max-w-none tour-content">
          <div set:html={post.content.rendered} />
        </div>
      </div>

      <!-- Sidebar con Precio, Formulario y Testimonios -->
      <div class="lg:col-span-1">
        <div class="sticky top-24 space-y-6">
          <!-- Card de Precio -->
          <div class="bg-[#15803d] text-white rounded-xl p-6 shadow-xl">
            <div class="text-center mb-6">
              <div class="text-sm mb-2">Precio por Persona</div>
              <div class="text-4xl font-bold mb-1">
                {post.acf?.precio || 'Consultar'}
              </div>
              {post.acf?.duracion && (
                <div class="text-sm text-yellow-400">
                  {post.acf.duracion}
                </div>
              )}
            </div>
            <a 
              href="#formulario-contacto"
              class="block w-full bg-yellow-400 text-gray-900 font-bold py-4 rounded-lg text-center hover:bg-yellow-500 transition-all duration-300 transform hover:scale-105 shadow-lg"
            >
              Solicitar Información
            </a>
          </div>

          <!-- Formulario de Contacto (Contact Form 7 API) -->
          <div id="formulario-contacto" class="bg-white rounded-xl p-6 shadow-lg border border-gray-200">
            <h3 class="text-xl font-bold mb-4 text-gray-900 flex items-center gap-2">
              <svg class="w-6 h-6 text-[#15803d]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
              Solicitar Información
            </h3>
            
            <!-- Formulario personalizado -->
            <form id="contact-form" class="space-y-4">
              <!-- Nombres -->
              <div>
                <label for="nombres" class="block text-sm font-medium text-gray-700 mb-1">
                  Nombres <span class="text-red-500">*</span>
                </label>
                <input 
                  type="text" 
                  id="nombres"
                  name="nombres" 
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#15803d] focus:border-transparent transition-colors"
                  placeholder="Juan Pérez"
                />
              </div>

              <!-- Email -->
              <div>
                <label for="emails" class="block text-sm font-medium text-gray-700 mb-1">
                  Email <span class="text-red-500">*</span>
                </label>
                <input 
                  type="email" 
                  id="emails"
                  name="emails" 
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#15803d] focus:border-transparent transition-colors"
                  placeholder="tu@email.com"
                />
              </div>

              <!-- Teléfono -->
              <div>
                <label for="telefono" class="block text-sm font-medium text-gray-700 mb-1">
                  Teléfono <span class="text-red-500">*</span>
                </label>
                <input 
                  type="text" 
                  id="telefono"
                  name="telefono" 
                  required
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#15803d] focus:border-transparent transition-colors"
                  placeholder="+51 999 999 999"
                />
              </div>

              <!-- Fecha -->
              <div>
                <label for="fecha" class="block text-sm font-medium text-gray-700 mb-1">
                  Fecha
                </label>
                <input 
                  type="date" 
                  id="fecha"
                  name="fecha" 
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#15803d] focus:border-transparent transition-colors"
                />
              </div>

              <!-- Mensaje -->
              <div>
                <label for="mensaje" class="block text-sm font-medium text-gray-700 mb-1">
                  Mensaje
                </label>
                <textarea 
                  id="mensaje"
                  name="mensaje" 
                  rows="3"
                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#15803d] focus:border-transparent transition-colors resize-none"
                  placeholder="Cuéntanos sobre tu viaje..."
                ></textarea>
              </div>

              <!-- Botón de envío -->
              <button 
                type="submit"
                class="w-full bg-[#15803d] hover:bg-[#166534] text-white font-bold py-3 px-6 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center gap-2"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
                Enviar Solicitud
              </button>

              <!-- Mensajes de respuesta -->
              <div id="form-response" class="hidden"></div>
            </form>
          </div>

          <!-- Carrusel de Testimonios -->
          {testimonials.length > 0 && (
            <div class="bg-gray-50 rounded-xl p-6 shadow-lg">
              <h3 class="text-xl font-bold mb-4 text-gray-900 flex items-center gap-2">
                <svg class="w-6 h-6 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>
                Lo que dicen nuestros clientes
              </h3>
              
              <div class="testimonial-carousel relative">
                <div class="testimonial-slides">
                  {testimonials.slice(0, 5).map((testimonial, index) => (
                    <div class="testimonial-slide" data-slide={index}>
                      <div class="bg-white p-5 rounded-lg shadow-md">
                        <!-- Rating -->
                        <div class="flex gap-1 mb-3">
                          {[...Array(5)].map((_, i) => (
                            <svg 
                              class={`w-5 h-5 ${i < testimonial.rating ? 'text-yellow-400' : 'text-gray-300'}`}
                              fill="currentColor" 
                              viewBox="0 0 20 20"
                            >
                              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                          ))}
                        </div>
                        
                        <!-- Texto -->
                        <p class="text-gray-700 text-sm mb-4 line-clamp-4">
                          {testimonial.comment}
                        </p>
                        
                        <!-- Autor -->
                        <div class="flex items-center justify-between text-sm">
                          <div>
                            <div class="font-semibold text-gray-900">{testimonial.name}</div>
                            {testimonial.date && (
                              <div class="text-gray-500 text-xs">{testimonial.date}</div>
                            )}
                          </div>
                          {testimonial.platform === 'tripadvisor' && (
                            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="#00AF87">
                              <path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm6.9 13.2c-1.5 1.5-3.5 2.3-5.6 2.3s-4.1-.8-5.6-2.3c-.4-.4-.4-1 0-1.4.4-.4 1-.4 1.4 0 2.3 2.3 6.1 2.3 8.5 0 .4-.4 1-.4 1.4 0 .3.4.3 1-.1 1.4z"/>
                            </svg>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                
                <!-- Indicadores de navegación -->
                {testimonials.length > 1 && (
                  <div class="flex justify-center gap-2 mt-4">
                    {testimonials.slice(0, 5).map((_, index) => (
                      <button 
                        class="testimonial-dot w-2 h-2 rounded-full bg-gray-300 transition-all duration-300"
                        data-index={index}
                        aria-label={`Ver testimonio ${index + 1}`}
                      ></button>
                    ))}
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Tours Relacionados -->
<section class="py-12 md:py-16 lg:py-20 bg-gray-50">
  <div class="container px-4">
    <div class="text-center mb-10 md:mb-12">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-3 md:mb-4">
        Otros <span class="text-[#15803d]">Tours Recomendados</span>
      </h2>
      <p class="text-base md:text-lg text-gray-600 max-w-2xl mx-auto">
        Descubre más experiencias increíbles en la Amazonía peruana
      </p>
    </div>

    <!-- Swiper de Tours -->
    <div class="swiper related-tours-swiper relative">
      <div class="swiper-wrapper">
        {toursWithImages
          .filter(tour => tour.slug !== post.slug)
          .slice(0, 6)
          .map((tour) => (
          <div class="swiper-slide h-auto">
            <article class="group relative bg-white rounded-xl md:rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-500 h-full">
              <a href={`/${tour.slug}`}>
                <!-- Imagen del Tour -->
                <div class="relative h-64 md:h-72 lg:h-80 overflow-hidden">
                  <img 
                    src={tour.imageUrl}
                    alt={tour.title.rendered}
                    class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                    loading="lazy"
                  />
                  <div class="absolute inset-0 bg-linear-to-t from-black/80 via-black/40 to-transparent"></div>
                  
                  <!-- Badge de Precio -->
                  <div class="absolute top-3 md:top-4 right-3 md:right-4 bg-linear-to-r from-yellow-400 to-yellow-500 text-gray-900 px-3 md:px-4 py-1.5 md:py-2 rounded-full font-bold text-xs md:text-sm shadow-lg">
                    {tour.acf?.precio || 'Consultar'}
                  </div>
                  
                  <!-- Título sobre la imagen -->
                  <div class="absolute bottom-0 left-0 right-0 p-4 md:p-6">
                    <h3 class="text-white font-bold text-lg md:text-xl mb-2 line-clamp-2" set:html={tour.title.rendered}>
                    </h3>
                  </div>
                </div>
                
                <!-- Contenido -->
                <div class="p-4 md:p-6 bg-linear-to-br from-white to-green-50">
                  <div class="text-gray-700 text-xs md:text-sm line-clamp-3 leading-relaxed mb-3 md:mb-4" set:html={tour.excerpt.rendered} />
                  
                  <!-- CTA Button -->
                  <div class="flex items-center justify-between">
                    <span class="inline-flex items-center gap-1 md:gap-2 text-[#15803d] font-semibold px-3 md:px-4 py-1.5 md:py-2 rounded-lg border-2 border-[#15803d] group-hover:bg-[#15803d] group-hover:text-white transition-all duration-300 text-xs md:text-sm">
                      <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                      </svg>
                      Ver detalles
                    </span>
                    
                    <div class="flex gap-1">
                      <span class="w-2 h-2 rounded-full bg-[#15803d] group-hover:bg-yellow-400 transition-colors"></span>
                      <span class="w-2 h-2 rounded-full bg-yellow-400 group-hover:bg-[#15803d] transition-colors"></span>
                      <span class="w-2 h-2 rounded-full bg-[#15803d] group-hover:bg-yellow-400 transition-colors"></span>
                    </div>
                  </div>
                </div>
              </a>
            </article>
          </div>
        ))}
      </div>
      
      <!-- Navegación -->
      <div class="swiper-button-next !text-[#15803d]"></div>
      <div class="swiper-button-prev !text-[#15803d]"></div>
      <div class="swiper-pagination !bottom-0"></div>
    </div>
  </div>
</section>

<!-- CTA Final -->
<section class="py-16 bg-linear-to-r from-[#15803d] to-[#166534]">
  <div class="container text-center text-white">
    <h2 class="text-3xl lg:text-4xl font-bold mb-4">
      ¿Listo para tu aventura?
    </h2>
    <p class="text-xl mb-8 max-w-2xl mx-auto">
      Contáctanos ahora y reserva tu lugar en este increíble tour por la Amazonía
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a 
        href="https://wa.me/51965001929?text=Hola,%20quiero%20información"
        class="inline-flex items-center justify-center gap-2 bg-white text-[#15803d] font-bold px-8 py-4 rounded-lg text-lg hover:bg-gray-100 transition-all duration-300 transform hover:scale-105"
      >
        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
          <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
        </svg>
        WhatsApp
      </a>
      
    </div>
  </div>
</section>

<style>
  /* Estilos para Swiper de tours relacionados */
  .related-tours-swiper .swiper-button-next,
  .related-tours-swiper .swiper-button-prev {
    color: #15803d;
    background: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  .related-tours-swiper .swiper-button-next:hover,
  .related-tours-swiper .swiper-button-prev:hover {
    background: #15803d;
    color: white;
  }

  .related-tours-swiper .swiper-button-next::after,
  .related-tours-swiper .swiper-button-prev::after {
    font-size: 18px;
    font-weight: bold;
  }

  .related-tours-swiper .swiper-pagination-bullet {
    background: #15803d;
    opacity: 0.3;
  }

  .related-tours-swiper .swiper-pagination-bullet-active {
    opacity: 1;
  }

  /* Estilos para listas avanzadas de WordPress */
  .tour-content :global(.wp-block-advgb-list ul li) {
    padding-left: 10px !important;
  }

  .tour-content :global(.wp-block-advgb-list li) {
    padding-left: 10px !important;
    margin-bottom: 0.5rem;
  }

  .tour-content :global(.wp-block-advgb-list ul),
  .tour-content :global(.wp-block-advgb-list ol) {
    margin-left: 1.5rem;
  }

  /* Listas con X (advgb-list-no) */
  .tour-content :global(.advgb-list-no li) {
    padding-left: 10px !important;
    margin-bottom: 0.5rem;
    position: relative;
  }

  .tour-content :global(.advgb-list-no li::before) {
    content: "✗" !important;
    color: #dc2626 !important;
    font-weight: bold !important;
    position: absolute;
    left: 3px;
  }

  .tour-content :global(h1),
  .tour-content :global(h2),
  .tour-content :global(h3) {
    color: #15803d;
    font-weight: bold;
    margin-top: 2rem;
    margin-bottom: 1.25rem;
    position: relative;
    padding-bottom: 0.75rem;
  }

  .tour-content :global(h2) {
    font-size: 1.875rem;
    line-height: 2.25rem;
  }

  .tour-content :global(h2::after) {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 60px;
    height: 3px;
    background: linear-gradient(90deg, #15803d 0%, #fbbf24 100%);
    border-radius: 2px;
  }

  .tour-content :global(h3) {
    font-size: 1.5rem;
    line-height: 2rem;
  }

  .tour-content :global(h3::after) {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 40px;
    height: 2px;
    background: #fbbf24;
    border-radius: 2px;
  }

  .tour-content :global(p) {
    margin-bottom: 1rem;
    line-height: 1.8;
    color: #374151;
  }

  .tour-content :global(ul),
  .tour-content :global(ol) {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .tour-content :global(li) {
    margin-bottom: 0.5rem;
    position: relative;
    padding-left: 0.5rem;
  }

  .tour-content :global(ul li::before) {
    content: "✓";
    color: #15803d;
    font-weight: bold;
    position: absolute;
    left: -1px;
  }

  .tour-content :global(img) {
    border-radius: 0.5rem;
    margin: 1.5rem 0;
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  }

  .tour-content :global(a) {
    color: #15803d;
    text-decoration: underline;
  }

  .tour-content :global(a:hover) {
    color: #166534;
  }

  /* Estilos para galerías de WordPress */
  .tour-content :global(.wp-block-gallery) {
    display: grid;
    gap: 0.75rem;
    margin: 2rem 0;
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery) {
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery) {
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }
  }

  .tour-content :global(.wp-block-gallery.columns-2) {
    grid-template-columns: repeat(2, 1fr);
  }

  .tour-content :global(.wp-block-gallery.columns-3) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-3) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-4) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-4) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-4) {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-5) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-5) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-5) {
      grid-template-columns: repeat(5, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-6) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-6) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-6) {
      grid-template-columns: repeat(6, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-7) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-7) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-7) {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (min-width: 1280px) {
    .tour-content :global(.wp-block-gallery.columns-7) {
      grid-template-columns: repeat(7, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-8) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-8) {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-8) {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (min-width: 1280px) {
    .tour-content :global(.wp-block-gallery.columns-8) {
      grid-template-columns: repeat(8, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery.columns-9),
  .tour-content :global(.wp-block-gallery.columns-10),
  .tour-content :global(.wp-block-gallery.columns-11),
  .tour-content :global(.wp-block-gallery.columns-12) {
    grid-template-columns: repeat(2, 1fr);
  }

  @media (min-width: 640px) {
    .tour-content :global(.wp-block-gallery.columns-9),
    .tour-content :global(.wp-block-gallery.columns-10),
    .tour-content :global(.wp-block-gallery.columns-11),
    .tour-content :global(.wp-block-gallery.columns-12) {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery.columns-9),
    .tour-content :global(.wp-block-gallery.columns-10),
    .tour-content :global(.wp-block-gallery.columns-11),
    .tour-content :global(.wp-block-gallery.columns-12) {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  @media (min-width: 1536px) {
    .tour-content :global(.wp-block-gallery.columns-9),
    .tour-content :global(.wp-block-gallery.columns-10),
    .tour-content :global(.wp-block-gallery.columns-11),
    .tour-content :global(.wp-block-gallery.columns-12) {
      grid-template-columns: repeat(6, 1fr);
    }
  }

  .tour-content :global(.wp-block-gallery .wp-block-image),
  .tour-content :global(.wp-block-gallery figure) {
    margin: 0;
  }

  .tour-content :global(.wp-block-gallery img) {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  @media (min-width: 768px) {
    .tour-content :global(.wp-block-gallery img) {
      height: 200px;
    }
  }

  @media (min-width: 1024px) {
    .tour-content :global(.wp-block-gallery img) {
      height: 220px;
    }
  }

  .tour-content :global(.wp-block-gallery img:hover) {
    transform: scale(1.05);
    box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.2);
  }

  :global(.fancybox__toolbar__items button) {
    color: #fff;
    opacity: 0.8;
    transition: opacity 0.2s ease;
  }

  :global(.fancybox__toolbar__items button:hover) {
    opacity: 1;
  }

  :global(.fancybox__toolbar__items button svg) {
    width: 24px;
    height: 24px;
  }

  .wp-block-advgb-list li {
    padding-left: 10px !important;
  }

  /* Estilos para el carrusel de testimonios */
  .testimonial-carousel {
    position: relative;
    overflow: hidden;
  }

  .testimonial-slides {
    position: relative;
    width: 100%;
  }

  .testimonial-slide {
    display: none;
    animation: fadeIn 0.5s ease-in-out;
  }

  .testimonial-slide.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .testimonial-dot {
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .testimonial-dot:hover {
    background-color: #15803d;
  }

  .testimonial-dot.active {
    background-color: #15803d;
    width: 24px;
  }

  .line-clamp-4 {
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  #contact-form input:focus,
  #contact-form textarea:focus {
    outline: none;
  }

  #contact-form button:disabled {
    opacity: 0.7;
    cursor: not-allowed;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  .animate-spin {
    animation: spin 1s linear infinite;
  }

  /* Estilos para acordeones de WordPress (advgb-accordions) */
  .tour-content :global(.advgb-accordion-wrapper) {
    margin: 2rem 0;
  }

  .tour-content :global(.advgb-accordion-item) {
    margin-bottom: 1rem;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .tour-content :global(.advgb-accordion-header) {
    background-color: #ffffff !important;
    color: #1f2937 !important;
    border: 1px solid #e5e7eb !important;
    border-radius: 0.5rem !important;
    padding: 1rem 1.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    transition: all 0.3s ease;
    user-select: none;
  }

  .tour-content :global(.advgb-accordion-header:hover) {
    background-color: #f9fafb !important;
    border-color: #15803d !important;
  }

  .tour-content :global(.advgb-accordion-header-icon) {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.3s ease;
  }

  .tour-content :global(.advgb-accordion-header-icon svg) {
    width: 20px;
    height: 20px;
    fill: #15803d;
  }

  .tour-content :global(.advgb-accordion-item.active .advgb-accordion-header-icon) {
    transform: rotate(180deg);
  }

  .tour-content :global(.advgb-accordion-header-title) {
    margin: 0 !important;
    font-size: 1.125rem;
    font-weight: 600;
    color: #1f2937;
  }

  .tour-content :global(.advgb-accordion-body) {
    max-height: 0;
    overflow: hidden;
    border: none !important;
    border-radius: 0 !important;
    transition: max-height 0.4s ease, padding 0.4s ease;
    padding: 0 1.5rem;
    border-color: #e3e3e3 !important;
  }

  .tour-content :global(.advgb-accordion-item.active .advgb-accordion-body) {
    max-height: 5000px;
    padding: 1.5rem;
    border-top: 1px solid #e5e7eb !important;
    border-color: #eee !important;
  }

  .tour-content :global(.advgb-accordion-body p) {
    margin: 0.75rem 0;
    line-height: 1.7;
    color: #4b5563;
  }

  .tour-content :global(.advgb-accordion-body p:first-child) {
    margin-top: 0;
  }

  .tour-content :global(.advgb-accordion-body p:last-child) {
    margin-bottom: 0;
  }

  .tour-content :global(.advgb-accordion-body strong) {
    color: #15803d;
    font-weight: 600;
  }
</style>

<script>
  import { Fancybox } from '@fancyapps/ui';
  import Swiper from 'swiper';
  import { Navigation, Pagination, Autoplay } from 'swiper/modules';

  document.addEventListener('DOMContentLoaded', function() {

    const galleries = document.querySelectorAll('.wp-block-gallery');
    
    galleries.forEach((gallery, galleryIndex) => {
      const images = gallery.querySelectorAll('img');
      
      images.forEach((img) => {
        const parent = img.parentElement;
        if (parent && !parent.hasAttribute('data-fancybox')) {
          const link = document.createElement('a');
          link.href = img.src;
          link.setAttribute('data-fancybox', `gallery-${galleryIndex}`);
          link.setAttribute('data-caption', img.alt || '');
          
          if (parent && img.parentNode) {
            img.parentNode.insertBefore(link, img);
            link.appendChild(img);
          }
        }
      });
    });
    
    Fancybox.bind('[data-fancybox]', {
      Toolbar: {
        display: {
          left: ["infobar"],
          middle: [],
          right: ["slideshow", "thumbs", "zoom", "download", "close"],
        },
      },
      Thumbs: {
        autoStart: true,
      },
      Images: {
        zoom: true,
      },
    });

    // Carrusel de testimonios
    const initTestimonialCarousel = () => {
      const slides = document.querySelectorAll('.testimonial-slide');
      const dots = document.querySelectorAll('.testimonial-dot');
      
      if (slides.length === 0) return;

      let currentSlide = 0;

      const showSlide = (index) => {
        slides.forEach(slide => slide.classList.remove('active'));
        dots.forEach(dot => dot.classList.remove('active'));
        
        if (slides[index]) {
          slides[index].classList.add('active');
        }
        if (dots[index]) {
          dots[index].classList.add('active');
        }
      };

      dots.forEach((dot, index) => {
        dot.addEventListener('click', () => {
          currentSlide = index;
          showSlide(currentSlide);
        });
      });

      const autoRotate = () => {
        currentSlide = (currentSlide + 1) % slides.length;
        showSlide(currentSlide);
      };

      showSlide(0);
      setInterval(autoRotate, 5000);
    };

    initTestimonialCarousel();

    // Funcionalidad de acordeones WordPress (advgb-accordions)
    const initAccordions = () => {
      const accordionHeaders = document.querySelectorAll('.advgb-accordion-header');
      
      accordionHeaders.forEach(header => {
        header.addEventListener('click', function() {
          const accordionItem = this.closest('.advgb-accordion-item');
          const isActive = accordionItem.classList.contains('active');
          
          // Cerrar todos los acordeones
          document.querySelectorAll('.advgb-accordion-item').forEach(item => {
            item.classList.remove('active');
          });
          
          // Abrir el acordeón clickeado si estaba cerrado
          if (!isActive) {
            accordionItem.classList.add('active');
          }
        });
      });
      
      // Expandir el primer acordeón por defecto
      const firstAccordion = document.querySelector('.advgb-accordion-item');
      if (firstAccordion) {
        firstAccordion.classList.add('active');
      }
    };

    initAccordions();

    // Formulario de contacto
    const contactForm = document.getElementById('contact-form');
    const formResponse = document.getElementById('form-response');
    
    if (contactForm) {
      contactForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = contactForm.querySelector('button[type="submit"]');
        const originalBtnText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<svg class="animate-spin h-5 w-5 mx-auto" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>';
        
        const formData = new FormData(contactForm);
        
        try {
          const CF7_FORM_ID = 'b32fc06';
          const response = await fetch(`http://web.ruth/wp-json/contact-form-7/v1/contact-forms/${CF7_FORM_ID}/feedback`, {
            method: 'POST',
            body: formData,
          });
          
          const result = await response.json();
          
          formResponse.classList.remove('hidden');
          
          if (result.status === 'mail_sent') {
            formResponse.innerHTML = `
              <div class="bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg flex items-start gap-3">
                <svg class="w-5 h-5 mt-0.5 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <div>
                  <div class="font-semibold">¡Mensaje enviado!</div>
                  <div class="text-sm">${result.message}</div>
                </div>
              </div>
            `;
            contactForm.reset();
            formResponse.scrollIntoView({ behavior: 'smooth', block: 'center' });
          } else {
            formResponse.innerHTML = `
              <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start gap-3">
                <svg class="w-5 h-5 mt-0.5 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
                <div>
                  <div class="font-semibold">Error al enviar</div>
                  <div class="text-sm">${result.message || 'Por favor, verifica los campos del formulario.'}</div>
                </div>
              </div>
            `;
          }
        } catch (error) {
          formResponse.classList.remove('hidden');
          formResponse.innerHTML = `
            <div class="bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg flex items-start gap-3">
              <svg class="w-5 h-5 mt-0.5 shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
              </svg>
              <div>
                <div class="font-semibold">Error de conexión</div>
                <div class="text-sm">No se pudo enviar el mensaje. Por favor, intenta nuevamente.</div>
              </div>
            </div>
          `;
          console.error('Error al enviar formulario:', error);
        } finally {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalBtnText;
        }
      });
    }

    // Swiper para tours relacionados
    if (document.querySelector('.related-tours-swiper')) {
      new Swiper('.related-tours-swiper', {
        modules: [Navigation, Pagination, Autoplay],
        slidesPerView: 1,
        spaceBetween: 24,
        loop: true,
        autoplay: {
          delay: 4000,
          disableOnInteraction: false,
        },
        navigation: {
          nextEl: '.related-tours-swiper .swiper-button-next',
          prevEl: '.related-tours-swiper .swiper-button-prev',
        },
        pagination: {
          el: '.related-tours-swiper .swiper-pagination',
          clickable: true,
        },
        breakpoints: {
          640: {
            slidesPerView: 2,
            spaceBetween: 24,
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 32,
          },
        },
      });
    }
  });
</script>
